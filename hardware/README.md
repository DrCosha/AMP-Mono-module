## Amplifiler control unit - hardware parts

В данной части будут приведены схемы и печатные платы, касающиеся модуля управления и его исполнительных и контрольных узлов.
Схема самого усилителя, основного блока питания и индикации остается для самостоятельной реализации.

## Cхема модуля управления

<div align="center"><img alt="Overview" width="800" src="/images/ACU_main_circuit_short.png" />&emsp;&emsp;&emsp;</div>

Общий вид 3D модели платы:

<div align="center"><img alt="Overview" width="600" src="/images/3D_acu_pcb_view.png" />&emsp;&emsp;&emsp;</div>

Собранная плата выглядит следующим образом:

<div align="center"><img alt="Overview" width="600" src="/images/acu_assembled_view.png" />&emsp;&emsp;&emsp;</div>

<br/>
<br/>

Основные сигналы модуля выведены на следующие разъемы:

|Номер разъема|Назначение|Распиновка|
|-------------|----------|----------|
|H1|`FLASH` - Разъем для подключения к порту TTL RS232, для перепрошивки модуля управления.| 1-**+3,3V**; 2-**TxD**; 3-**RxD**; 4-**GND**|
|JP1|`TRIG_IN` - Trigger IN - входящий сигнал внешнего включения. Уровень сигнала **+5..12В**. Потребляемый ток до **15mA**. | 1-**GND**; 2-**NC**; 3-**trig_in**|
|JP2|`TRIG_OUT` - Trigger OUT - исходящий сигнал для включения дочерних устройств. **+12В**, нагрузка до **100mA** | 1-**GND**; 2-**NC**; 3-**trig_out**|
|JP3|`1Wire` - Шина OneWire - однопроводная шина Peer2Peer для синхронизации модулей между собой. До 10 устройств на одной шине.| 1-**GND**; 2-**NC**; 3-**1Wire**|
|N1|`VU_Mute` - Сигнал выключения модуля стрелочной индикации в моменты включения/выключения усилителя для подавления переходных процессов. [^1]| 1-**VU_Mute**; 2-**GND**|
|N3|`LED_PWM` - Питание подсветки стрелочного индикатора. PWM сигнал напряжением +12V. Управление по шине GND.| 1-**+12V**; 2-**PWM**|  
|N4|`SELECTOR` - Сигнал управления реле с обмоткой расчитанной на 5V. Переключение реле выбирает XLR или RCA вход.| 1-**+5V**; 2-**SELECT**|
|CN1|`POWER` - Разъем подачи основного питания +12V на модуль управления и возврата сигнала **power_relay** на плату блока питания. Сигнал управляет включением основного силового реле усилителя и подачей питания на платы защиты АС.[^1]| 1-**power_relay**; 2..3-**+12V**; 4..5-**GND**|
|CN4|`MAIN PANEL` - Разъем подключения платы трехцветного LED индикатора питания и кнопки `POWER` на лицевой панели.| 1-**LED_RED**; 2-**LED_BLUE**; 3-**LED_GREEN**; 4-**GND**; 5-**power_bttn**|
|CN5|`SELECT PANEL` - Разъем подключения платы индикации селектора входов, кнопки управления селектором, и кнопки выбора режима подсветки стрелочного индикатора. Рядом с кнопками расположен датчик внешней освещенности, для автоматического режима подсветки.| 1-**LED_XLR**; 2-**ILUM_BTTN**; 3-**SEL_BTTN**; 4-**ILUM_SENS**; 5-**LED_RCA**; 6..7-**GND**; 8-**+5V**|

[^1]: Внимание: Сигнал является прымым выходом GPIO микроконтроллера и не должен нагружатся более чем на 20mA!

<br/>

## Модуль standby питания и основное силовое реле

<div align="center"><img alt="Overview" width="800" src="/images/p&r_circuits_short.png" />&emsp;&emsp;&emsp;</div>
<br/>
<br/>

Основные сигналы модуля выведены на следующие разъемы:

|Номер разъема|Назначение|Распиновка|
|-------------|----------|----------|
|P1|`POWER` - Вход ~220V. ***Провод заземления не используется!!!*** | 1-**N**; 2-**L**|
|P2; P3|`MAIN_RELAY` - Выход ~220V на главные блоки питания. Защищены предохранителем **5A**| 1-**L**; 2-**N**|
|CN2|`CPU_POWER` - Ответный разъем для CN1 на основной плате модуля управления. Разъем подачи основного питания +12V на модуль управления и возврата сигнала **power_relay** на плату блока питания. Сигнал управляет включением основного силового реле усилителя и подачей питания на платы защиты АС.[^1]| 1-**power_relay**; 2..3-**+12V**; 4..5-**GND**|
|N2|`ACC_PROTECT` - Разъем подачи +12V на модуль защиты акустических систем при общем включении усилителя.| 1-**+12V**; 2-**GND**|
<br/>
<br/>

Список элементов, примененных в схемах модуля CPU и платы его питания представлен в таблице ниже и файле [BOM AMP CPU & PM.csv](https://github.com/DrCosha/AMP-Mono-module/blob/master/hardware/BOM_AMP_CPU_&_PM_rev4.csv):

|N |Значение|Номера элементов|Тип элемента|Количество|
|--|----|----------|---------|--------|
|1 |0.1u |C1,C2,C3,C5,C6,C7,C9,C12,C13,C16 |C0805 |10 |
|2 |220u |C4 |CASE-D_7343 |1 |
|3 |22u |C8 |CASE-C_6032 |1 |
|4 |1000u 25V |C10,C11 |CAP-D12.5×F5.0 |2 |
|5 |470u |C14 |CASE-C_6032 |1 |
|6 |220u |C15 |CASE-C_6032 |1 |
|7 |XH-5A_C26521 |CN1,CN2,CN4 |XH-5A |3 |
|8 |XH-8A_C722885 |CN5 |XH-8A |1 |
|9 |1SS352 |D1,D2 |SOD-323 |2 |
|10 |1N5817 |D3,D4 |DO-41 |2 |
|11 |KBU810 |D5 |KBU810 |1 |
|12 |FUSE 1A |F1 |FUSE_HOLDER_5X20MM |1 |
|13 |FUSE 5A |F2 |FUSE_HOLDER_5X20MM |1 |
|14 |HDR-F-2.54_1x4 |H1 |HDR-F-2.54_1X4 |1 |
|15 |M03JST-PTH |JP1,JP2,JP3 |JST-3PIN |3 |
|16 |G6S-2 DC12 |K1 |RELAY-TH_G6S-2 |1 |
|17 |RESET |KEY1 |KEY-SMD_2P |1 |
|18 |FLASH |KEY2 |KEY-SMD_2P |1 |
|19 |JST-2PIN |N1,N2,N3,N4 |JST-2PIN |4 |
|20 |CONN-TH_2P-P5.00 |P1,P2,P3 |JST-2PIN |3 |
|21 |2SA1708S-AN |Q1 |ONSC-NMP-3-135AD |1 |
|22 |KRC104S-RTK/P |Q2 |SOT-23-3 |1 |
|23 |DTU40N06 |Q3,Q5,Q6 |TO-252 |3 |
|24 |BSS138W-F2-0000HF |Q4 |SOT-323 |1 |
|25 |10K |R1,R2,R3,R4,R5,R6,R13,R17,R16,R22,R24 |R0805 |11 |
|26 |2,2K |R7 |R0805 |1 |
|27 |1K |R8,R9,R10 |R0805 |3 |
|28 |22 |R11 |TH_BD4.5-L11.5 |1 |
|29 |100K |R12 |R0805 |1 |
|30 |510 |R14,R18 |R0805 |2 |
|31 |330 |R15,R19,R21,R23 |R0805 |4 |
|32 |4,7k |R20 |R0805 |1 |
|33 |13K |R25 |R0805 |1 |
|34 |560 |R26 |R0805 |1 |
|35 |120 |R27,R28 |R1206 |2 |
|36 |JQX-105F-1/012D-1HS |RELAY1 |RELAY-TH_JQX-105F-1-012D-1HS |1 |
|37 |PTC10 |T1 |PTC10 TRANSFORMER |1 |
|38 |PC817 |U1,U3,U4,U5 |PC817C SMD |4 |
|39 |ESP-32S-MY |U2 |ESP32S |1 |
|40 |B1205S-1WSY |U6,U9 |PWRM-TH_B1205S-1WSY |2 |
|41 |L7812CV-DG |U7 |TO-220-3 |1 |
|42 |LM1117-3,3 |U8 |SOT-223 |1 |
|43 |23.5*16*25 Heat sink |U10 |HEATSINK-TH_L23.5-W16.0|1 |

<br/>
<br/>


## Схемы плат индикации и контроля

<div align="center"><img height="250" src="/images/power_panel_short.png"/>&emsp; <img height="250" src="/images/selector_panel_short.png"/></div>

<br/>
<br/>

Общее описание программной части и настройки здесь: [README.md](https://github.com/DrCosha/AMP-Mono-module/blob/master/README.md)
